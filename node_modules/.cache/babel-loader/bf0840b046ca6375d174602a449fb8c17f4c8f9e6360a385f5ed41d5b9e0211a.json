{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useParams}from'react-router-dom';import{API_BASE}from'../config/config';import{createClient}from'@supabase/supabase-js';import SalvaButton from'../components/SalvaButton';// âœ… Importa il bottone\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const supabase=createClient(process.env.REACT_APP_SUPABASE_URL,process.env.REACT_APP_SUPABASE_ANON_KEY);const DettaglioRichiesta=()=>{const{id}=useParams();const[richiesta,setRichiesta]=useState(null);const[errore,setErrore]=useState('');const[showSegnala,setShowSegnala]=useState(false);const[motivoSegnalazione,setMotivoSegnalazione]=useState('');const[segnalazioneInviata,setSegnalazioneInviata]=useState(false);const[userId,setUserId]=useState(null);useEffect(()=>{const fetchRichiesta=async()=>{try{const res=await fetch(`${API_BASE}/api/richiesta/${id}`,{headers:{Authorization:`Bearer ${localStorage.getItem('token')}`}});const data=await res.json();if(!res.ok)throw new Error(data.error||'Errore nel caricamento');setRichiesta(data);}catch(err){setErrore(err.message);}};const getUserId=()=>{const token=localStorage.getItem('token');if(token){const payload=JSON.parse(atob(token.split('.')[1]));setUserId(payload.id);}};fetchRichiesta();getUserId();},[id]);const segnalaRichiesta=async()=>{if(!motivoSegnalazione.trim())return alert(\"Inserisci un motivo valido\");const token=localStorage.getItem('token');const payload=JSON.parse(atob(token.split('.')[1]));const{error}=await supabase.from('segnalazioni').insert({richiesta_id:richiesta.id,email_committente:richiesta.email_committente,email_segnalante:payload.email,motivo:motivoSegnalazione});if(!error){setSegnalazioneInviata(true);setShowSegnala(false);}else{alert(\"Errore nell'invio segnalazione\");}};return/*#__PURE__*/_jsxs(\"div\",{style:{padding:'1rem'},children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83D\\uDCC4 Dettaglio richiesta\"}),errore&&/*#__PURE__*/_jsx(\"p\",{style:{color:'red'},children:errore}),richiesta?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center'},children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Categoria:\"}),\" \",richiesta.categoria]}),userId&&/*#__PURE__*/_jsx(SalvaButton,{richiestaId:richiesta.id,userId:userId})]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Localit\\xE0:\"}),\" \",richiesta.localita]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Descrizione:\"}),\" \",richiesta.descrizione]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Contatti:\"}),\" \",richiesta.contatti]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Data:\"}),\" \",new Date(richiesta.data_inserimento).toLocaleString()]}),!segnalazioneInviata&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowSegnala(true),children:\"\\uD83D\\uDEA9 Segnala richiesta\"}),showSegnala&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'1rem'},children:[/*#__PURE__*/_jsx(\"textarea\",{value:motivoSegnalazione,onChange:e=>setMotivoSegnalazione(e.target.value),placeholder:\"Motivo della segnalazione...\",rows:3,style:{width:'100%',marginBottom:'0.5rem'}}),/*#__PURE__*/_jsx(\"button\",{onClick:segnalaRichiesta,style:{backgroundColor:'red',color:'white'},children:\"Invia segnalazione\"})]})]}),segnalazioneInviata&&/*#__PURE__*/_jsx(\"p\",{style:{color:'green'},children:\"\\u2705 Richiesta segnalata agli amministratori.\"})]}):/*#__PURE__*/_jsx(\"p\",{children:\"Caricamento...\"})]});};export default DettaglioRichiesta;","map":{"version":3,"names":["React","useEffect","useState","useParams","API_BASE","createClient","SalvaButton","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","supabase","process","env","REACT_APP_SUPABASE_URL","REACT_APP_SUPABASE_ANON_KEY","DettaglioRichiesta","id","richiesta","setRichiesta","errore","setErrore","showSegnala","setShowSegnala","motivoSegnalazione","setMotivoSegnalazione","segnalazioneInviata","setSegnalazioneInviata","userId","setUserId","fetchRichiesta","res","fetch","headers","Authorization","localStorage","getItem","data","json","ok","Error","error","err","message","getUserId","token","payload","JSON","parse","atob","split","segnalaRichiesta","trim","alert","from","insert","richiesta_id","email_committente","email_segnalante","email","motivo","style","padding","children","color","display","justifyContent","alignItems","categoria","richiestaId","localita","descrizione","contatti","Date","data_inserimento","toLocaleString","onClick","marginTop","value","onChange","e","target","placeholder","rows","width","marginBottom","backgroundColor"],"sources":["C:/Users/151702/Desktop/Inquotus/Inquotus-frontend-ruoli/src/richieste/DettaglioRichiesta.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { API_BASE } from '../config/config';\nimport { createClient } from '@supabase/supabase-js';\nimport SalvaButton from '../components/SalvaButton'; // âœ… Importa il bottone\n\nconst supabase = createClient(\n  process.env.REACT_APP_SUPABASE_URL,\n  process.env.REACT_APP_SUPABASE_ANON_KEY\n);\n\nconst DettaglioRichiesta = () => {\n  const { id } = useParams();\n  const [richiesta, setRichiesta] = useState(null);\n  const [errore, setErrore] = useState('');\n  const [showSegnala, setShowSegnala] = useState(false);\n  const [motivoSegnalazione, setMotivoSegnalazione] = useState('');\n  const [segnalazioneInviata, setSegnalazioneInviata] = useState(false);\n  const [userId, setUserId] = useState(null);\n\n  useEffect(() => {\n    const fetchRichiesta = async () => {\n      try {\n        const res = await fetch(`${API_BASE}/api/richiesta/${id}`, {\n          headers: {\n            Authorization: `Bearer ${localStorage.getItem('token')}`\n          }\n        });\n        const data = await res.json();\n        if (!res.ok) throw new Error(data.error || 'Errore nel caricamento');\n        setRichiesta(data);\n      } catch (err) {\n        setErrore(err.message);\n      }\n    };\n\n    const getUserId = () => {\n      const token = localStorage.getItem('token');\n      if (token) {\n        const payload = JSON.parse(atob(token.split('.')[1]));\n        setUserId(payload.id);\n      }\n    };\n\n    fetchRichiesta();\n    getUserId();\n  }, [id]);\n\n  const segnalaRichiesta = async () => {\n    if (!motivoSegnalazione.trim()) return alert(\"Inserisci un motivo valido\");\n\n    const token = localStorage.getItem('token');\n    const payload = JSON.parse(atob(token.split('.')[1]));\n\n    const { error } = await supabase.from('segnalazioni').insert({\n      richiesta_id: richiesta.id,\n      email_committente: richiesta.email_committente,\n      email_segnalante: payload.email,\n      motivo: motivoSegnalazione,\n    });\n\n    if (!error) {\n      setSegnalazioneInviata(true);\n      setShowSegnala(false);\n    } else {\n      alert(\"Errore nell'invio segnalazione\");\n    }\n  };\n\n  return (\n    <div style={{ padding: '1rem' }}>\n      <h2>ðŸ“„ Dettaglio richiesta</h2>\n\n      {errore && <p style={{ color: 'red' }}>{errore}</p>}\n\n      {richiesta ? (\n        <div>\n          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n            <p><strong>Categoria:</strong> {richiesta.categoria}</p>\n            {userId && <SalvaButton richiestaId={richiesta.id} userId={userId} />}\n          </div>\n          <p><strong>LocalitÃ :</strong> {richiesta.localita}</p>\n          <p><strong>Descrizione:</strong> {richiesta.descrizione}</p>\n          <p><strong>Contatti:</strong> {richiesta.contatti}</p>\n          <p><strong>Data:</strong> {new Date(richiesta.data_inserimento).toLocaleString()}</p>\n\n          {!segnalazioneInviata && (\n            <>\n              <button onClick={() => setShowSegnala(true)}>ðŸš© Segnala richiesta</button>\n\n              {showSegnala && (\n                <div style={{ marginTop: '1rem' }}>\n                  <textarea\n                    value={motivoSegnalazione}\n                    onChange={(e) => setMotivoSegnalazione(e.target.value)}\n                    placeholder=\"Motivo della segnalazione...\"\n                    rows={3}\n                    style={{ width: '100%', marginBottom: '0.5rem' }}\n                  />\n                  <button onClick={segnalaRichiesta} style={{ backgroundColor: 'red', color: 'white' }}>\n                    Invia segnalazione\n                  </button>\n                </div>\n              )}\n            </>\n          )}\n\n          {segnalazioneInviata && <p style={{ color: 'green' }}>âœ… Richiesta segnalata agli amministratori.</p>}\n        </div>\n      ) : (\n        <p>Caricamento...</p>\n      )}\n    </div>\n  );\n};\n\nexport default DettaglioRichiesta;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}