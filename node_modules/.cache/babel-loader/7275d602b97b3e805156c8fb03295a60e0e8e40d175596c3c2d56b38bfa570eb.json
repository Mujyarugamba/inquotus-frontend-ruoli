{"ast":null,"code":"import React,{useEffect,useState}from'react';import{createClient}from'@supabase/supabase-js';import{salvaNotifica}from'../utils/salvaNotifica';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const supabase=createClient(process.env.REACT_APP_SUPABASE_URL,process.env.REACT_APP_SUPABASE_ANON_KEY);const StoricoNotifiche=_ref=>{let{setNotificheCount}=_ref;const[notifiche,setNotifiche]=useState([]);const[loading,setLoading]=useState(true);const[utenteEmail,setUtenteEmail]=useState(null);const[filtroTipo,setFiltroTipo]=useState('tutte');useEffect(()=>{const token=localStorage.getItem('token');if(!token)return;try{const payload=JSON.parse(atob(token.split('.')[1]));setUtenteEmail(payload.email);}catch{setUtenteEmail(null);}},[]);const fetchNotifiche=async()=>{if(!utenteEmail)return;const{data,error}=await supabase.from('notifiche').select('*').eq('email_utente',utenteEmail).order('timestamp',{ascending:false});if(!error)setNotifiche(data);setLoading(false);};const segnaTutteComeLette=async()=>{if(!utenteEmail)return;await supabase.from('notifiche').update({letto:true}).eq('email_utente',utenteEmail).eq('letto',false);if(setNotificheCount)setNotificheCount(0);fetchNotifiche();};useEffect(()=>{fetchNotifiche();},[utenteEmail]);useEffect(()=>{if(!utenteEmail)return;const channel=supabase.channel('realtime-notifiche').on('postgres_changes',{event:'*',schema:'public',table:'notifiche'},payload=>{var _payload$new;if(((_payload$new=payload.new)===null||_payload$new===void 0?void 0:_payload$new.email_utente)===utenteEmail){fetchNotifiche();}}).subscribe();return()=>{supabase.removeChannel(channel);};},[utenteEmail]);const notificheFiltrate=filtroTipo==='tutte'?notifiche:notifiche.filter(n=>n.tipo===filtroTipo);return/*#__PURE__*/_jsxs(\"div\",{style:{padding:'1rem'},children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83D\\uDCDC Storico notifiche\"}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'1rem',display:'flex',alignItems:'center',gap:'1rem'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:segnaTutteComeLette,style:{padding:'0.4rem 0.8rem',backgroundColor:'#28a745',color:'#fff',border:'none',borderRadius:'5px',cursor:'pointer'},children:\"\\u2705 Segna tutte come lette\"}),/*#__PURE__*/_jsxs(\"select\",{value:filtroTipo,onChange:e=>setFiltroTipo(e.target.value),style:{padding:'0.4rem',borderRadius:'5px'},children:[/*#__PURE__*/_jsx(\"option\",{value:\"tutte\",children:\"Tutte\"}),/*#__PURE__*/_jsx(\"option\",{value:\"INSERT\",children:\"Nuove richieste\"}),/*#__PURE__*/_jsx(\"option\",{value:\"UPDATE\",children:\"Modifiche\"}),/*#__PURE__*/_jsx(\"option\",{value:\"DELETE\",children:\"Cancellazioni\"})]})]}),loading?/*#__PURE__*/_jsx(\"p\",{children:\"Caricamento...\"}):notificheFiltrate.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"Nessuna notifica registrata.\"}):/*#__PURE__*/_jsx(\"ul\",{style:{listStyle:'none',padding:0},children:notificheFiltrate.map((n,i)=>/*#__PURE__*/_jsxs(\"li\",{style:{marginBottom:'1rem',padding:'1rem',border:'1px solid #ddd',borderRadius:'8px',backgroundColor:n.letto?'#f9f9f9':'#e8f4ff',boxShadow:'0 1px 3px rgba(0, 0, 0, 0.05)'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:'bold',marginBottom:'0.3rem'},children:n.tipo}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'0.9rem',color:'#555'},children:n.descrizione||'Nessuna descrizione disponibile.'}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'0.75rem',color:'#999',marginTop:'0.5rem'},children:new Date(n.timestamp).toLocaleString()})]},i))})]});};export default StoricoNotifiche;","map":{"version":3,"names":["React","useEffect","useState","createClient","salvaNotifica","jsx","_jsx","jsxs","_jsxs","supabase","process","env","REACT_APP_SUPABASE_URL","REACT_APP_SUPABASE_ANON_KEY","StoricoNotifiche","_ref","setNotificheCount","notifiche","setNotifiche","loading","setLoading","utenteEmail","setUtenteEmail","filtroTipo","setFiltroTipo","token","localStorage","getItem","payload","JSON","parse","atob","split","email","fetchNotifiche","data","error","from","select","eq","order","ascending","segnaTutteComeLette","update","letto","channel","on","event","schema","table","_payload$new","new","email_utente","subscribe","removeChannel","notificheFiltrate","filter","n","tipo","style","padding","children","marginBottom","display","alignItems","gap","onClick","backgroundColor","color","border","borderRadius","cursor","value","onChange","e","target","length","listStyle","map","i","boxShadow","fontWeight","fontSize","descrizione","marginTop","Date","timestamp","toLocaleString"],"sources":["C:/Users/151702/Desktop/Inquotus/Inquotus-frontend-ruoli/src/notifiche/StoricoNotifiche.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { createClient } from '@supabase/supabase-js';\nimport { salvaNotifica } from '../utils/salvaNotifica';\n\nconst supabase = createClient(\n  process.env.REACT_APP_SUPABASE_URL,\n  process.env.REACT_APP_SUPABASE_ANON_KEY\n);\n\nconst StoricoNotifiche = ({ setNotificheCount }) => {\n  const [notifiche, setNotifiche] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [utenteEmail, setUtenteEmail] = useState(null);\n  const [filtroTipo, setFiltroTipo] = useState('tutte');\n\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    if (!token) return;\n    try {\n      const payload = JSON.parse(atob(token.split('.')[1]));\n      setUtenteEmail(payload.email);\n    } catch {\n      setUtenteEmail(null);\n    }\n  }, []);\n\n  const fetchNotifiche = async () => {\n    if (!utenteEmail) return;\n\n    const { data, error } = await supabase\n      .from('notifiche')\n      .select('*')\n      .eq('email_utente', utenteEmail)\n      .order('timestamp', { ascending: false });\n\n    if (!error) setNotifiche(data);\n    setLoading(false);\n  };\n\n  const segnaTutteComeLette = async () => {\n    if (!utenteEmail) return;\n\n    await supabase\n      .from('notifiche')\n      .update({ letto: true })\n      .eq('email_utente', utenteEmail)\n      .eq('letto', false);\n\n    if (setNotificheCount) setNotificheCount(0);\n    fetchNotifiche();\n  };\n\n  useEffect(() => {\n    fetchNotifiche();\n  }, [utenteEmail]);\n\n  useEffect(() => {\n    if (!utenteEmail) return;\n\n    const channel = supabase\n      .channel('realtime-notifiche')\n      .on(\n        'postgres_changes',\n        { event: '*', schema: 'public', table: 'notifiche' },\n        (payload) => {\n          if (payload.new?.email_utente === utenteEmail) {\n            fetchNotifiche();\n          }\n        }\n      )\n      .subscribe();\n\n    return () => {\n      supabase.removeChannel(channel);\n    };\n  }, [utenteEmail]);\n\n  const notificheFiltrate = filtroTipo === 'tutte'\n    ? notifiche\n    : notifiche.filter(n => n.tipo === filtroTipo);\n\n  return (\n    <div style={{ padding: '1rem' }}>\n      <h2>ðŸ“œ Storico notifiche</h2>\n\n      <div style={{ marginBottom: '1rem', display: 'flex', alignItems: 'center', gap: '1rem' }}>\n        <button\n          onClick={segnaTutteComeLette}\n          style={{\n            padding: '0.4rem 0.8rem',\n            backgroundColor: '#28a745',\n            color: '#fff',\n            border: 'none',\n            borderRadius: '5px',\n            cursor: 'pointer'\n          }}\n        >\n          âœ… Segna tutte come lette\n        </button>\n\n        <select\n          value={filtroTipo}\n          onChange={(e) => setFiltroTipo(e.target.value)}\n          style={{ padding: '0.4rem', borderRadius: '5px' }}\n        >\n          <option value=\"tutte\">Tutte</option>\n          <option value=\"INSERT\">Nuove richieste</option>\n          <option value=\"UPDATE\">Modifiche</option>\n          <option value=\"DELETE\">Cancellazioni</option>\n        </select>\n      </div>\n\n      {loading ? (\n        <p>Caricamento...</p>\n      ) : notificheFiltrate.length === 0 ? (\n        <p>Nessuna notifica registrata.</p>\n      ) : (\n        <ul style={{ listStyle: 'none', padding: 0 }}>\n          {notificheFiltrate.map((n, i) => (\n            <li\n              key={i}\n              style={{\n                marginBottom: '1rem',\n                padding: '1rem',\n                border: '1px solid #ddd',\n                borderRadius: '8px',\n                backgroundColor: n.letto ? '#f9f9f9' : '#e8f4ff',\n                boxShadow: '0 1px 3px rgba(0, 0, 0, 0.05)'\n              }}\n            >\n              <div style={{ fontWeight: 'bold', marginBottom: '0.3rem' }}>{n.tipo}</div>\n              <div style={{ fontSize: '0.9rem', color: '#555' }}>{n.descrizione || 'Nessuna descrizione disponibile.'}</div>\n              <div style={{ fontSize: '0.75rem', color: '#999', marginTop: '0.5rem' }}>\n                {new Date(n.timestamp).toLocaleString()}\n              </div>\n            </li>\n          ))}\n        </ul>\n      )}\n    </div>\n  );\n};\n\nexport default StoricoNotifiche;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}