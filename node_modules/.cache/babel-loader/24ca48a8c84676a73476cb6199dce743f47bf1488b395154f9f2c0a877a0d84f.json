{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useParams,useNavigate}from'react-router-dom';import{API_BASE}from'../config/config';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const RichiestaModifica=()=>{const{id}=useParams();const navigate=useNavigate();const[richiesta,setRichiesta]=useState(null);const[regioni,setRegioni]=useState([]);const[province,setProvince]=useState([]);const[comuni,setComuni]=useState([]);const[messaggio,setMessaggio]=useState('');const token=localStorage.getItem('token');// Carica dati iniziali\nuseEffect(()=>{const fetchData=async()=>{try{const res=await fetch(`${API_BASE}/api/richiesta/${id}`,{headers:{Authorization:`Bearer ${token}`}});const data=await res.json();if(!res.ok)throw new Error(data.error||'Errore');setRichiesta(data);}catch(err){setMessaggio('‚ùå Errore caricamento richiesta');}};fetchData();fetch('/data/province-per-regione.json').then(res=>res.json()).then(setRegioni).catch(()=>setMessaggio('‚ùå Errore caricamento regioni'));},[id,token]);// Carica province in base alla regione\nuseEffect(()=>{if(richiesta!==null&&richiesta!==void 0&&richiesta.regione){const selected=regioni.find(r=>r.nome===richiesta.regione);setProvince((selected===null||selected===void 0?void 0:selected.province)||[]);}},[richiesta===null||richiesta===void 0?void 0:richiesta.regione,regioni]);// Carica comuni\nuseEffect(()=>{if(richiesta!==null&&richiesta!==void 0&&richiesta.provincia){fetch(`/data/comuni/${richiesta.provincia}.json`).then(res=>res.json()).then(setComuni).catch(()=>setComuni([]));}},[richiesta===null||richiesta===void 0?void 0:richiesta.provincia]);const handleChange=e=>{const{name,value}=e.target;setRichiesta(prev=>({...prev,[name]:value}));};const handleCheckbox=e=>{setRichiesta(prev=>({...prev,urgente:e.target.checked}));};const handleSubmit=async e=>{e.preventDefault();try{const res=await fetch(`${API_BASE}/api/richiesta/${id}`,{method:'PUT',headers:{'Content-Type':'application/json',Authorization:`Bearer ${token}`},body:JSON.stringify(richiesta)});const data=await res.json();if(res.ok){setMessaggio('‚úÖ Richiesta aggiornata con successo');setTimeout(()=>navigate('/mie-richieste'),1500);}else{setMessaggio(`‚ùå ${data.error||'Errore salvataggio'}`);}}catch{setMessaggio('‚ùå Errore di rete');}};if(!richiesta)return/*#__PURE__*/_jsx(\"p\",{children:\"\\u23F3 Caricamento...\"});return/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,style:{maxWidth:600,margin:'2rem auto'},children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u270F\\uFE0F Modifica Richiesta\"}),/*#__PURE__*/_jsx(\"label\",{children:\"Categoria:\"}),/*#__PURE__*/_jsx(\"input\",{name:\"categoria\",value:richiesta.categoria,onChange:handleChange,required:true}),/*#__PURE__*/_jsx(\"label\",{children:\"Regione:\"}),/*#__PURE__*/_jsxs(\"select\",{name:\"regione\",value:richiesta.regione,onChange:handleChange,required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Seleziona una regione\"}),regioni.map(r=>/*#__PURE__*/_jsx(\"option\",{value:r.nome,children:r.nome},r.nome))]}),/*#__PURE__*/_jsx(\"label\",{children:\"Provincia:\"}),/*#__PURE__*/_jsxs(\"select\",{name:\"provincia\",value:richiesta.provincia,onChange:handleChange,required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Seleziona una provincia\"}),province.map(p=>/*#__PURE__*/_jsx(\"option\",{value:p,children:p},p))]}),/*#__PURE__*/_jsx(\"label\",{children:\"Comune:\"}),/*#__PURE__*/_jsx(\"input\",{list:\"comuni\",name:\"localita\",value:richiesta.localita,onChange:handleChange,required:true}),/*#__PURE__*/_jsx(\"datalist\",{id:\"comuni\",children:comuni.map(c=>/*#__PURE__*/_jsx(\"option\",{children:c},c))}),/*#__PURE__*/_jsx(\"label\",{children:\"Descrizione:\"}),/*#__PURE__*/_jsx(\"textarea\",{name:\"descrizione\",value:richiesta.descrizione,onChange:handleChange,rows:4,required:true}),/*#__PURE__*/_jsx(\"label\",{children:\"Contatti aggiuntivi:\"}),/*#__PURE__*/_jsx(\"input\",{name:\"contatti\",value:richiesta.contatti||'',onChange:handleChange}),/*#__PURE__*/_jsxs(\"label\",{children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:richiesta.urgente,onChange:handleCheckbox}),\" Urgente\"]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"\\uD83D\\uDCBE Salva modifiche\"}),messaggio&&/*#__PURE__*/_jsx(\"p\",{style:{marginTop:'1rem',color:messaggio.startsWith('‚úÖ')?'green':'red'},children:messaggio})]});};export default RichiestaModifica;","map":{"version":3,"names":["React","useEffect","useState","useParams","useNavigate","API_BASE","jsx","_jsx","jsxs","_jsxs","RichiestaModifica","id","navigate","richiesta","setRichiesta","regioni","setRegioni","province","setProvince","comuni","setComuni","messaggio","setMessaggio","token","localStorage","getItem","fetchData","res","fetch","headers","Authorization","data","json","ok","Error","error","err","then","catch","regione","selected","find","r","nome","provincia","handleChange","e","name","value","target","prev","handleCheckbox","urgente","checked","handleSubmit","preventDefault","method","body","JSON","stringify","setTimeout","children","onSubmit","style","maxWidth","margin","categoria","onChange","required","map","p","list","localita","c","descrizione","rows","contatti","type","marginTop","color","startsWith"],"sources":["C:/Users/151702/Desktop/Inquotus/Inquotus-frontend-ruoli/src/richieste/RichiestaModifica.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { API_BASE } from '../config/config';\n\nconst RichiestaModifica = () => {\n  const { id } = useParams();\n  const navigate = useNavigate();\n  const [richiesta, setRichiesta] = useState(null);\n  const [regioni, setRegioni] = useState([]);\n  const [province, setProvince] = useState([]);\n  const [comuni, setComuni] = useState([]);\n  const [messaggio, setMessaggio] = useState('');\n  const token = localStorage.getItem('token');\n\n  // Carica dati iniziali\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        const res = await fetch(`${API_BASE}/api/richiesta/${id}`, {\n          headers: { Authorization: `Bearer ${token}` }\n        });\n        const data = await res.json();\n        if (!res.ok) throw new Error(data.error || 'Errore');\n        setRichiesta(data);\n      } catch (err) {\n        setMessaggio('‚ùå Errore caricamento richiesta');\n      }\n    };\n\n    fetchData();\n    fetch('/data/province-per-regione.json')\n      .then(res => res.json())\n      .then(setRegioni)\n      .catch(() => setMessaggio('‚ùå Errore caricamento regioni'));\n  }, [id, token]);\n\n  // Carica province in base alla regione\n  useEffect(() => {\n    if (richiesta?.regione) {\n      const selected = regioni.find(r => r.nome === richiesta.regione);\n      setProvince(selected?.province || []);\n    }\n  }, [richiesta?.regione, regioni]);\n\n  // Carica comuni\n  useEffect(() => {\n    if (richiesta?.provincia) {\n      fetch(`/data/comuni/${richiesta.provincia}.json`)\n        .then(res => res.json())\n        .then(setComuni)\n        .catch(() => setComuni([]));\n    }\n  }, [richiesta?.provincia]);\n\n  const handleChange = (e) => {\n    const { name, value } = e.target;\n    setRichiesta(prev => ({ ...prev, [name]: value }));\n  };\n\n  const handleCheckbox = (e) => {\n    setRichiesta(prev => ({ ...prev, urgente: e.target.checked }));\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    try {\n      const res = await fetch(`${API_BASE}/api/richiesta/${id}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${token}`\n        },\n        body: JSON.stringify(richiesta)\n      });\n      const data = await res.json();\n      if (res.ok) {\n        setMessaggio('‚úÖ Richiesta aggiornata con successo');\n        setTimeout(() => navigate('/mie-richieste'), 1500);\n      } else {\n        setMessaggio(`‚ùå ${data.error || 'Errore salvataggio'}`);\n      }\n    } catch {\n      setMessaggio('‚ùå Errore di rete');\n    }\n  };\n\n  if (!richiesta) return <p>‚è≥ Caricamento...</p>;\n\n  return (\n    <form onSubmit={handleSubmit} style={{ maxWidth: 600, margin: '2rem auto' }}>\n      <h2>‚úèÔ∏è Modifica Richiesta</h2>\n\n      <label>Categoria:</label>\n      <input name=\"categoria\" value={richiesta.categoria} onChange={handleChange} required />\n\n      <label>Regione:</label>\n      <select name=\"regione\" value={richiesta.regione} onChange={handleChange} required>\n        <option value=\"\">Seleziona una regione</option>\n        {regioni.map(r => (\n          <option key={r.nome} value={r.nome}>{r.nome}</option>\n        ))}\n      </select>\n\n      <label>Provincia:</label>\n      <select name=\"provincia\" value={richiesta.provincia} onChange={handleChange} required>\n        <option value=\"\">Seleziona una provincia</option>\n        {province.map(p => (\n          <option key={p} value={p}>{p}</option>\n        ))}\n      </select>\n\n      <label>Comune:</label>\n      <input list=\"comuni\" name=\"localita\" value={richiesta.localita} onChange={handleChange} required />\n      <datalist id=\"comuni\">\n        {comuni.map(c => (\n          <option key={c}>{c}</option>\n        ))}\n      </datalist>\n\n      <label>Descrizione:</label>\n      <textarea name=\"descrizione\" value={richiesta.descrizione} onChange={handleChange} rows={4} required />\n\n      <label>Contatti aggiuntivi:</label>\n      <input name=\"contatti\" value={richiesta.contatti || ''} onChange={handleChange} />\n\n      <label>\n        <input type=\"checkbox\" checked={richiesta.urgente} onChange={handleCheckbox} /> Urgente\n      </label>\n\n      <br /><br />\n      <button type=\"submit\">üíæ Salva modifiche</button>\n      {messaggio && <p style={{ marginTop: '1rem', color: messaggio.startsWith('‚úÖ') ? 'green' : 'red' }}>{messaggio}</p>}\n    </form>\n  );\n};\n\nexport default RichiestaModifica;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}